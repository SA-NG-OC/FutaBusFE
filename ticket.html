<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>V√© ƒêi·ªán T·ª≠ - Fuba Bus</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #E74C3C;
            /* M√†u cam ƒë·ªè gi·ªëng ·∫£nh */
            --text-dark: #1F2937;
            --text-gray: #6B7280;
            --bg-color: #F3F4F6;
            --white: #FFFFFF;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-dark);
            display: flex;
            justify-content: center;
            min-height: 100vh;
            padding: 20px;
        }

        /* Container m√¥ ph·ªèng chi·∫øc v√© */
        .ticket-card {
            background: var(--white);
            width: 100%;
            max-width: 400px;
            border-radius: 16px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            overflow: hidden;
            position: relative;
        }

        /* Header tr·∫°ng th√°i */
        .ticket-header {
            background-color: #FEF2F2;
            color: var(--primary-color);
            padding: 12px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: 600;
            font-size: 14px;
        }

        /* Ph·∫ßn QR Code */
        .qr-section {
            text-align: center;
            padding: 24px 0;
            border-bottom: 2px dashed #E5E7EB;
        }

        .qr-placeholder {
            width: 150px;
            height: 150px;
            background-color: #f0f0f0;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            color: #888;
        }

        .qr-section img {
            width: 160px;
            height: 160px;
            display: block;
            margin: 0 auto;
        }

        /* C√°c ph·∫ßn th√¥ng tin */
        .section {
            padding: 20px;
            border-bottom: 1px solid #E5E7EB;
        }

        .section:last-child {
            border-bottom: none;
        }

        .section-title {
            font-size: 16px;
            font-weight: 700;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .section-title i {
            color: var(--primary-color);
        }

        /* Row th√¥ng tin (Label - Value) */
        .info-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 12px;
        }

        .info-row:last-child {
            margin-bottom: 0;
        }

        .label {
            color: var(--text-gray);
            font-size: 13px;
        }

        .value {
            font-weight: 600;
            font-size: 14px;
            text-align: right;
            max-width: 60%;
        }

        .highlight {
            color: var(--primary-color);
            font-size: 18px;
            font-weight: 700;
        }

        /* Timeline ƒêi·ªÉm ƒëi - ƒêi·ªÉm ƒë·∫øn */
        .timeline {
            position: relative;
            padding-left: 20px;
        }

        .timeline-item {
            position: relative;
            margin-bottom: 24px;
        }

        .timeline-item:last-child {
            margin-bottom: 0;
        }

        .timeline-item::before {
            content: '';
            position: absolute;
            left: -20px;
            top: 4px;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            border: 2px solid var(--primary-color);
            background: var(--white);
        }

        .timeline-item.start::before {
            background: var(--primary-color);
        }

        .timeline-line {
            position: absolute;
            left: -15px;
            top: 14px;
            bottom: 20px;
            /* K·∫øt th√∫c tr∆∞·ªõc ƒëi·ªÉm cu·ªëi */
            width: 2px;
            background-color: #E5E7EB;
        }

        .time {
            font-weight: 700;
            font-size: 15px;
            color: var(--primary-color);
        }

        .location {
            font-weight: 600;
            font-size: 14px;
            margin-top: 2px;
        }

        .address {
            font-size: 12px;
            color: var(--text-gray);
            margin-top: 2px;
        }

        /* Loading & Error States */
        #loading,
        #error {
            text-align: center;
            padding: 40px;
            display: none;
        }

        #ticket-content {
            display: none;
            /* ·∫®n m·∫∑c ƒë·ªãnh, hi·ªán khi load xong */
        }

        .btn-action {
            display: block;
            width: calc(100% - 40px);
            margin: 20px auto;
            padding: 14px;
            background-color: var(--primary-color);
            color: white;
            text-align: center;
            text-decoration: none;
            border-radius: 8px;
            font-weight: 600;
            border: none;
            cursor: pointer;
        }
    </style>
</head>

<body>

    <div id="loading">
        <p>ƒêang t·∫£i th√¥ng tin v√©...</p>
    </div>

    <div id="error">
        <h3 style="color: red;">Kh√¥ng t√¨m th·∫•y v√©!</h3>
        <p>Vui l√≤ng ki·ªÉm tra l·∫°i m√£ ho·∫∑c li√™n h·ªá nh√† xe.</p>
    </div>

    <div class="ticket-card" id="ticket-content">
        <div class="ticket-header">
            <span>üé´ Th√¥ng tin v√©</span>
            <span id="ticket-status-badge"
                style="background: #fff; padding: 2px 8px; border-radius: 4px; font-size: 12px; border: 1px solid #FECACA;">ƒê√£
                x√°c nh·∫≠n</span>
        </div>

        <div class="qr-section">
            <img id="qr-image" src="" alt="QR Code" />
            <div style="margin-top: 10px; font-weight: bold; color: #333;" id="ticket-code-display">CODE</div>
        </div>

        <div class="section">
            <div class="section-title">üöå Th√¥ng tin chuy·∫øn ƒëi</div>
            <div class="timeline">
                <div class="timeline-line"></div>

                <div class="timeline-item start">
                    <div class="time" id="pickup-time">--:--</div>
                    <div class="location" id="pickup-name">...</div>
                    <div class="address" id="pickup-address">...</div>
                </div>

                <div class="timeline-item end">
                    <div class="time" id="dropoff-time">--:--</div>
                    <div class="location" id="dropoff-name">...</div>
                    <div class="address" id="dropoff-address">...</div>
                </div>
            </div>

            <div style="margin-top: 16px; padding-top: 16px; border-top: 1px dashed #E5E7EB;">
                <div class="info-row">
                    <span class="label">Ng√†y kh·ªüi h√†nh</span>
                    <span class="value" id="trip-date">...</span>
                </div>
                <div class="info-row">
                    <span class="label">Lo·∫°i xe</span>
                    <span class="value" id="vehicle-type">...</span>
                </div>
                <div class="info-row">
                    <span class="label">Bi·ªÉn s·ªë</span>
                    <span class="value" id="license-plate">...</span>
                </div>
                <div class="info-row">
                    <span class="label">T√†i x·∫ø</span>
                    <span class="value" id="driver-name">...</span>
                </div>
            </div>
        </div>

        <div class="section">
            <div class="section-title">üë§ H√†nh kh√°ch</div>
            <div class="info-row">
                <span class="label">H·ªç v√† t√™n</span>
                <span class="value" id="passenger-name">...</span>
            </div>
            <div class="info-row">
                <span class="label">S·ªë ƒëi·ªán tho·∫°i</span>
                <span class="value" id="passenger-phone">...</span>
            </div>
            <div class="info-row">
                <span class="label">Email</span>
                <span class="value" id="passenger-email">...</span>
            </div>
        </div>

        <div class="section">
            <div class="section-title">üí∫ Th√¥ng tin gh·∫ø</div>
            <div class="info-row">
                <span class="label">S·ªë gh·∫ø</span>
                <span class="value highlight" id="seat-number">A01</span>
            </div>
            <div class="info-row">
                <span class="label">V·ªã tr√≠</span>
                <span class="value" id="seat-floor">T·∫ßng d∆∞·ªõi</span>
            </div>
            <div class="info-row">
                <span class="label">T·ªïng ti·ªÅn</span>
                <span class="value" style="color: var(--primary-color); font-weight: bold;" id="ticket-price">0 ƒë</span>
            </div>
        </div>

        <button class="btn-action" onclick="window.print()">üñ®Ô∏è In v√© / Ch·ª•p m√†n h√¨nh</button>
    </div>

    <script>
        // C·∫§U H√åNH API URL (ƒê·ªïi port n·∫øu c·∫ßn)
        const API_BASE_URL = 'http://localhost:5230';

        document.addEventListener('DOMContentLoaded', () => {
            // 1. L·∫•y m√£ v√© t·ª´ URL (v√≠ d·ª•: ticket.html?code=TK-TEST-001)
            const urlParams = new URLSearchParams(window.location.search);
            const ticketCode = urlParams.get('code');

            if (!ticketCode) {
                showError();
                return;
            }

            fetchTicketDetails(ticketCode);
        });

        async function fetchTicketDetails(code) {
            showLoading();
            try {
                // G·ªçi API Java Spring Boot
                const response = await fetch(`${API_BASE_URL}/tickets/${code}`);

                if (!response.ok) {
                    throw new Error('Ticket not found');
                }

                const responseBody = await response.json();

                if (responseBody.success) {
                    renderTicket(responseBody.data);
                    // Set lu√¥n ·∫£nh QR t·ª´ API Backend
                    document.getElementById('qr-image').src = `${API_BASE_URL}/tickets/${code}/qr`;
                } else {
                    showError();
                }

            } catch (error) {
                console.error('L·ªói:', error);
                showError();
            }
        }

        function renderTicket(data) {
            // Helper ƒë·ªÉ format ti·ªÅn
            const formatCurrency = (amount) => {
                return new Intl.NumberFormat('vi-VN', { style: 'currency', currency: 'VND' }).format(amount);
            };

            // 1. Header & QR
            document.getElementById('ticket-code-display').textContent = data.ticketInfo.ticketCode;
            document.getElementById('ticket-status-badge').textContent = data.ticketInfo.status;

            // 2. Pickup / Dropoff
            document.getElementById('pickup-time').textContent = data.pickupInfo.time;
            document.getElementById('pickup-name').textContent = data.pickupInfo.locationName;
            document.getElementById('pickup-address').textContent = data.pickupInfo.address;

            document.getElementById('dropoff-time').textContent = data.dropoffInfo.time;
            document.getElementById('dropoff-name').textContent = data.dropoffInfo.locationName;
            document.getElementById('dropoff-address').textContent = data.dropoffInfo.address;

            // 3. Trip Info
            document.getElementById('trip-date').textContent = data.tripInfo.departureDate;
            document.getElementById('vehicle-type').textContent = data.tripInfo.vehicleType;
            document.getElementById('license-plate').textContent = data.tripInfo.licensePlate;
            document.getElementById('driver-name').textContent = data.tripInfo.driverName;

            // 4. Passenger
            document.getElementById('passenger-name').textContent = data.passengerInfo.fullName;
            document.getElementById('passenger-phone').textContent = data.passengerInfo.phoneNumber;
            document.getElementById('passenger-email').textContent = data.passengerInfo.email;

            // 5. Seat & Price
            document.getElementById('seat-number').textContent = data.seatInfo.seatNumber;
            document.getElementById('seat-floor').textContent = `${data.seatInfo.floor} - ${data.seatInfo.position}`;
            document.getElementById('ticket-price').textContent = formatCurrency(data.ticketInfo.price);

            // Hi·ªÉn th·ªã giao di·ªán
            document.getElementById('loading').style.display = 'none';
            document.getElementById('ticket-content').style.display = 'block';
        }

        function showLoading() {
            document.getElementById('loading').style.display = 'block';
            document.getElementById('ticket-content').style.display = 'none';
            document.getElementById('error').style.display = 'none';
        }

        function showError() {
            document.getElementById('loading').style.display = 'none';
            document.getElementById('ticket-content').style.display = 'none';
            document.getElementById('error').style.display = 'block';
        }
    </script>
</body>

</html>